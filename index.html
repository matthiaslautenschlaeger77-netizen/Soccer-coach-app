<!DOCTYPE html>
<html>
<head>
    <title>Soccer Coach Playing Time Tracker</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Arial', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        header { background: white; padding: 2rem; border-radius: 15px; text-align: center; margin-bottom: 2rem; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        h1 { color: #2c3e50; font-size: 2.5rem; margin-bottom: 0.5rem; }
        .dashboard { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem; }
        @media (max-width: 768px) { .dashboard { grid-template-columns: 1fr; } }
        .card { background: white; padding: 2rem; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .card h2 { color: #2c3e50; margin-bottom: 1.5rem; border-bottom: 3px solid #3498db; padding-bottom: 0.5rem; }
        .form-group { margin-bottom: 1.5rem; }
        label { display: block; margin-bottom: 0.5rem; color: #2c3e50; font-weight: bold; }
        select, input { width: 100%; padding: 12px; border: 2px solid #bdc3c7; border-radius: 8px; font-size: 1rem; transition: border-color 0.3s; }
        select:focus, input:focus { outline: none; border-color: #3498db; }
        button { background: linear-gradient(135deg, #3498db, #2980b9); color: white; border: none; padding: 15px 25px; border-radius: 8px; font-size: 1rem; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; margin: 5px; }
        button:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .player-list { max-height: 400px; overflow-y: auto; }
        .player-item { display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #f8f9fa; margin-bottom: 0.5rem; border-radius: 8px; border-left: 4px solid #3498db; }
        .player-info { flex-grow: 1; }
        .player-name { font-weight: bold; color: #2c3e50; }
        .player-number { background: #3498db; color: white; border-radius: 50%; width: 30px; height: 30px; display: inline-flex; align-items: center; justify-content: center; margin-right: 10px; font-weight: bold; }
        .player-controls { display: flex; gap: 10px; align-items: center; }
        .player-input { width: 120px; }
        .small-input { width: 60px; }
        .remove-btn { background: #e74c3c; padding: 8px 12px; }
        .time-distribution { margin-top: 1rem; }
        .time-item { margin-bottom: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 8px; }
        .time-header { display: flex; justify-content: space-between; margin-bottom: 0.5rem; }
        .time-bar { background: #ecf0f1; height: 20px; border-radius: 10px; overflow: hidden; }
        .time-fill { background: linear-gradient(90deg, #2ecc71, #27ae60); height: 100%; transition: width 0.5s ease; }
        .simulation-container { background: #2c3e50; color: white; padding: 1.5rem; border-radius: 10px; margin-top: 1rem; }
        .game-progress { background: #34495e; height: 20px; border-radius: 10px; margin-bottom: 1rem; overflow: hidden; }
        .progress-fill { background: linear-gradient(90deg, #3498db, #2980b9); height: 100%; transition: width 0.3s; }
        .simulation-log { height: 200px; overflow-y: auto; background: #1a252f; padding: 1rem; border-radius: 5px; font-family: 'Courier New', monospace; }
        .log-entry { margin-bottom: 0.5rem; padding: 0.3rem; border-radius: 3px; }
        .log-entry.substitution { background: rgba(52, 152, 219, 0.2); border-left: 3px solid #3498db; }
        .log-entry.suggestion { background: rgba(241, 196, 15, 0.2); border-left: 3px solid #f1c40f; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem; }
        .stat-card { background: #34495e; padding: 1rem; border-radius: 8px; text-align: center; }
        .stat-value { font-size: 2rem; font-weight: bold; color: #3498db; }
        .stat-label { color: #bdc3c7; font-size: 0.9rem; }
        .filter-controls { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem; }
        .filter-group { background: #f8f9fa; padding: 1rem; border-radius: 8px; }
        .time-input-group { display: flex; gap: 10px; align-items: center; }
        .time-input-group input { flex: 1; }
        .unit-select { width: 80px; }
        
        /* Formation Field Styles */
        .formation-container { margin-top: 1rem; }
        .soccer-field { background: #27ae60; border: 2px solid #2c3e50; border-radius: 10px; padding: 20px; position: relative; min-height: 400px; }
        .field-lines { position: absolute; top: 0; left: 0; right: 0; bottom: 0; border: 2px solid white; border-radius: 8px; }
        .center-circle { position: absolute; top: 50%; left: 50%; width: 80px; height: 80px; border: 2px solid white; border-radius: 50%; transform: translate(-50%, -50%); }
        .center-spot { position: absolute; top: 50%; left: 50%; width: 8px; height: 8px; background: white; border-radius: 50%; transform: translate(-50%, -50%); }
        .player-circle { position: absolute; width: 40px; height: 40px; background: #3498db; border: 2px solid white; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; cursor: pointer; transition: all 0.3s; }
        .player-circle:hover { transform: scale(1.1); background: #2980b9; }
        .player-circle.bench { background: #e74c3c; }
        .player-circle.bench:hover { background: #c0392b; }
        
        /* Simulation Controls */
        .simulation-controls { display: flex; gap: 10px; margin-bottom: 1rem; }
        .pause-btn { background: #f39c12; }
        .resume-btn { background: #27ae60; }
        .substitution-panel { background: #34495e; padding: 1rem; border-radius: 8px; margin-top: 1rem; }
        .substitution-instruction { text-align: center; margin-bottom: 1rem; color: #bdc3c7; }
        .field-players, .bench-players { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px; margin-bottom: 1rem; }
        .position-group { margin-bottom: 1rem; }
        .position-title { color: #3498db; font-weight: bold; margin-bottom: 0.5rem; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚öΩ Soccer Coach Playing Time Tracker</h1>
            <p class="subtitle">Smart playing time distribution and game simulation</p>
        </header>
        
        <div class="dashboard">
            <div>
                <div class="card">
                    <h2>Game Setup</h2>
                    <div class="form-group">
                        <label for="gameType">Game Format:</label>
                        <select id="gameType" onchange="updateFormations(); drawFormation();">
                            <option value="7v7">7v7 (50 minutes)</option>
                            <option value="9v9">9v9 (70 minutes)</option>
                            <option value="11v11" selected>11v11 (90 minutes)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="formation">Formation:</label>
                        <select id="formation" onchange="drawFormation()"></select>
                    </div>
                    
                    <div class="formation-container">
                        <h3>Formation View</h3>
                        <div class="soccer-field" id="soccerField">
                            <div class="field-lines"></div>
                            <div class="center-circle"></div>
                            <div class="center-spot"></div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h2>Team Roster</h2>
                    <div class="player-list" id="playersList"></div>
                    <button onclick="addPlayer()">‚ûï Add Player</button>
                    <button onclick="addSampleTeam()">üéØ Add Sample Team</button>
                </div>
            </div>
            
            <div>
                <div class="card">
                    <h2>Playing Time Rules</h2>
                    <div class="filter-controls">
                        <div class="filter-group">
                            <label>Minimum Playing Time:</label>
                            <div class="time-input-group">
                                <input type="number" id="minTimeValue" value="45" min="0">
                                <select id="minTimeUnit" class="unit-select" onchange="updateTimeInputs()">
                                    <option value="minutes">Minutes</option>
                                    <option value="percent">%</option>
                                </select>
                            </div>
                        </div>
                        <div class="filter-group">
                            <label>Maximum Playing Time:</label>
                            <div class="time-input-group">
                                <input type="number" id="maxTimeValue" value="90" min="0">
                                <select id="maxTimeUnit" class="unit-select" onchange="updateTimeInputs()">
                                    <option value="minutes">Minutes</option>
                                    <option value="percent">%</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="priorityPlayers">Priority Players (get more time):</label>
                        <select id="priorityPlayers" multiple style="height: 100px;"></select>
                        <small>Hold Ctrl/Cmd to select multiple players</small>
                    </div>
                    
                    <button onclick="calculatePlayingTime()">üéÆ Calculate Playing Time</button>
                    <button onclick="startSimulation()">‚ö° Simulate Game (10x speed)</button>
                </div>
                
                <div class="card">
                    <h2>Playing Time Distribution</h2>
                    <div id="results">
                        <p style="text-align: center; color: #7f8c8d; padding: 2rem;">
                            Configure your team and rules, then click "Calculate Playing Time"
                        </p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2>Game Simulation & Suggestions</h2>
            <div class="simulation-controls" id="simulationControls" style="display: none;">
                <button class="pause-btn" onclick="pauseSimulation()">‚è∏Ô∏è Pause</button>
                <button class="resume-btn" onclick="resumeSimulation()">‚ñ∂Ô∏è Resume</button>
                <button onclick="resetSimulation()">üîÑ Reset</button>
            </div>
            <div id="simulationContainer">
                <p style="text-align: center; color: #7f88d; padding: 1rem;">
                    Start simulation to see substitution patterns and get AI suggestions
                </p>
            </div>
            <div id="substitutionPanel" class="substitution-panel" style="display: none;">
                <div class="substitution-instruction">‚è∏Ô∏è Simulation Paused - Make substitutions below</div>
                <div class="position-group">
                    <div class="position-title">On Field:</div>
                    <div class="field-players" id="fieldPlayers"></div>
                </div>
                <div class="position-group">
                    <div class="position-title">On Bench:</div>
                    <div class="bench-players" id="benchPlayers"></div>
                </div>
                <button onclick="applySubstitutions()">‚úÖ Apply Substitutions & Continue</button>
            </div>
        </div>
    </div>

    <script>
        let players = [];
        let nextId = 1;
        let nextJerseyNumber = 1;
        let simulationInterval;
        let currentMinute = 0;
        let isPaused = false;
        let fieldPlayers = [];
        let benchPlayers = [];
        
        const gameConfig = {
            '7v7': { duration: 50, playersOnField: 7 },
            '9v9': { duration: 70, playersOnField: 9 },
            '11v11': { duration: 90, playersOnField: 11 }
        };
        
        const formations = {
            '7v7': ['2-3-1', '3-2-1', '2-2-2', '3-1-2', '2-1-2-1'],
            '9v9': ['3-3-2', '3-2-3', '3-4-1', '4-3-1', '4-2-2'],
            '11v11': ['4-4-2', '4-3-3', '4-2-3-1', '3-5-2', '4-1-4-1']
        };
        
        // Formation positions for different formations
        const formationPositions = {
            '4-4-2': [
                {x: 50, y: 85}, // GK
                {x: 25, y: 70}, {x: 40, y: 70}, {x: 60, y: 70}, {x: 75, y: 70}, // Defense
                {x: 25, y: 50}, {x: 40, y: 50}, {x: 60, y: 50}, {x: 75, y: 50}, // Midfield
                {x: 40, y: 30}, {x: 60, y: 30} // Attack
            ],
            '4-3-3': [
                {x: 50, y: 85}, // GK
                {x: 25, y: 70}, {x: 40, y: 70}, {x: 60, y: 70}, {x: 75, y: 70}, // Defense
                {x: 35, y: 50}, {x: 50, y: 50}, {x: 65, y: 50}, // Midfield
                {x: 30, y: 30}, {x: 50, y: 30}, {x: 70, y: 30} // Attack
            ],
            '4-2-3-1': [
                {x: 50, y: 85}, // GK
                {x: 25, y: 70}, {x: 40, y: 70}, {x: 60, y: 70}, {x: 75, y: 70}, // Defense
                {x: 40, y: 55}, {x: 60, y: 55}, // CDM
                {x: 30, y: 40}, {x: 50, y: 40}, {x: 70, y: 40}, // CAM
                {x: 50, y: 25} // ST
            ],
            '3-5-2': [
                {x: 50, y: 85}, // GK
                {x: 30, y: 70}, {x: 50, y: 70}, {x: 70, y: 70}, // Defense
                {x: 15, y: 55}, {x: 35, y: 55}, {x: 50, y: 55}, {x: 65, y: 55}, {x: 85, y: 55}, // Midfield
                {x: 40, y: 30}, {x: 60, y: 30} // Attack
            ],
            '2-3-1': [
                {x: 50, y: 85}, // GK
                {x: 35, y: 70}, {x: 65, y: 70}, // Defense
                {x: 25, y: 55}, {x: 50, y: 55}, {x: 75, y: 55}, // Midfield
                {x: 50, y: 35} // Attack
            ],
            '3-3-2': [
                {x: 50, y: 85}, // GK
                {x: 30, y: 70}, {x: 50, y: 70}, {x: 70, y: 70}, // Defense
                {x: 30, y: 55}, {x: 50, y: 55}, {x: 70, y: 55}, // Midfield
                {x: 40, y: 35}, {x: 60, y: 35} // Attack
            ]
        };
        
        function initializeSampleTeam() {
            const sampleNames = ["Alex Johnson", "Ben Smith", "Carlos Rodriguez", "David Lee", "Ethan Wilson", "Frank Miller", "George Brown", "Henry Davis", "Ian Moore", "Jack Taylor", "Kevin Anderson", "Liam Thomas", "Mike Garcia", "Noah Martinez"];
            
            players = sampleNames.map((name, index) => ({
                id: index + 1,
                name: name,
                jerseyNumber: index + 1,
                skill: Math.floor(Math.random() * 5) + 6,
                position: "Field",
                assignedMinutes: 0,
                isOnField: index < 11
            }));
            
            nextId = players.length + 1;
            nextJerseyNumber = players.length + 1;
            updateFieldAndBench();
            displayPlayers();
            updatePrioritySelect();
            drawFormation();
        }
        
        function addPlayer() {
            const newPlayer = {
                id: nextId++,
                name: `Player ${nextJerseyNumber}`,
                jerseyNumber: nextJerseyNumber++,
                skill: 5,
                position: "Field",
                assignedMinutes: 0,
                isOnField: false
            };
            
            players.push(newPlayer);
            updateFieldAndBench();
            displayPlayers();
            updatePrioritySelect();
        }
        
        function addSampleTeam() {
            initializeSampleTeam();
        }
        
        function removePlayer(id) {
            players = players.filter(player => player.id !== id);
            updateFieldAndBench();
            displayPlayers();
            updatePrioritySelect();
        }
        
        function updatePlayerName(id, newName) {
            const player = players.find(p => p.id === id);
            if (player) player.name = newName;
        }
        
        function updatePlayerNumber(id, newNumber) {
            const player = players.find(p => p.id === id);
            if (player) player.jerseyNumber = parseInt(newNumber);
        }
        
        function updatePlayerSkill(id, skill) {
            const player = players.find(p => p.id === id);
            if (player) player.skill = parseInt(skill);
        }
        
        function displayPlayers() {
            const list = document.getElementById('playersList');
            list.innerHTML = '';
            
            players.forEach(player => {
                const playerDiv = document.createElement('div');
                playerDiv.className = 'player-item';
                playerDiv.innerHTML = `
                    <div class="player-info">
                        <div class="player-name">
                            <span class="player-number">${player.jerseyNumber}</span>
                            <input type="text" class="player-input" value="${player.name}" onchange="updatePlayerName(${player.id}, this.value)">
                        </div>
                        <small>Skill: ${player.skill}/10 ${player.isOnField ? 'üèÉ‚Äç‚ôÇÔ∏è On Field' : 'ü™ë On Bench'}</small>
                    </div>
                    <div class="player-controls">
                        <label>#: <input type="number" class="small-input" value="${player.jerseyNumber}" min="1" max="99" onchange="updatePlayerNumber(${player.id}, this.value)"></label>
                        <label>Skill: <input type="number" class="small-input" value="${player.skill}" min="1" max="10" onchange="updatePlayerSkill(${player.id}, this.value)"></label>
                        <button class="remove-btn" onclick="removePlayer(${player.id})">Remove</button>
                    </div>
                `;
                list.appendChild(playerDiv);
            });
        }
        
        function updatePrioritySelect() {
            const select = document.getElementById('priorityPlayers');
            select.innerHTML = '';
            players.forEach(player => {
                const option = document.createElement('option');
                option.value = player.id;
                option.textContent = `#${player.jerseyNumber} ${player.name}`;
                select.appendChild(option);
            });
        }
        
        function updateFormations() {
            const gameType = document.getElementById('gameType').value;
            const formationSelect = document.getElementById('formation');
            formationSelect.innerHTML = '';
            formations[gameType].forEach(formation => {
                const option = document.createElement('option');
                option.value = formation;
                option.textContent = formation;
                formationSelect.appendChild(option);
            });
        }
        
        function drawFormation() {
            const field = document.getElementById('soccerField');
            const formation = document.getElementById('formation').value;
            const gameType = document.getElementById('gameType').value;
            const positions = formationPositions[formation] || formationPositions['4-4-2'];
            
            // Clear existing players
            const existingPlayers = field.querySelectorAll('.player-circle');
            existingPlayers.forEach(player => player.remove());
            
            // Get players on field
            const onFieldPlayers = players.filter(p => p.isOnField).slice(0, gameConfig[gameType].playersOnField);
            
            // Create player circles
            onFieldPlayers.forEach((player, index) => {
                if (index < positions.length) {
                    const pos = positions[index];
                    const playerCircle = document.createElement('div');
                    playerCircle.className = 'player-circle';
                    playerCircle.style.left = `${pos.x}%`;
                    playerCircle.style.top = `${pos.y}%`;
                    playerCircle.textContent = player.jerseyNumber;
                    playerCircle.title = `${player.name} (#${player.jerseyNumber})`;
                    playerCircle.onclick = () => substitutePlayer(player.id);
                    field.appendChild(playerCircle);
                }
            });
        }
        
        function updateFieldAndBench() {
            const gameType = document.getElementById('gameType').value;
            const maxOnField = gameConfig[gameType].playersOnField;
            
            // Ensure we don't have more players on field than allowed
            let onFieldCount = players.filter(p => p.isOnField).length;
            if (onFieldCount > maxOnField) {
                // Move excess players to bench
                players.filter(p => p.isOnField).slice(maxOnField).forEach(player => {
                    player.isOnField = false;
                });
            }
            
            fieldPlayers = players.filter(p => p.isOnField);
            benchPlayers = players.filter(p => !p.isOnField);
        }
        
        function updateTimeInputs() {
            const gameType = document.getElementById('gameType').value;
            const gameDuration = gameConfig[gameType].duration;
            const minUnit = document.getElementById('minTimeUnit').value;
            const maxUnit = document.getElementById('maxTimeUnit').value;
            
            if (minUnit === 'percent') {
                document.getElementById('minTimeValue').max = 100;
            } else {
                document.getElementById('minTimeValue').max = gameDuration;
            }
            
            if (maxUnit === 'percent') {
                document.getElementById('maxTimeValue').max = 100;
            } else {
                document.getElementById('maxTimeValue').max = gameDuration;
            }
        }
        
        function calculatePlayingTime() {
            const gameType = document.getElementById('gameType').value;
            const config = gameConfig[gameType];
            const prioritySelect = document.getElementById('priorityPlayers');
            const priorityPlayers = Array.from(prioritySelect.selectedOptions).map(opt => parseInt(opt.value));
            
            const minTimeValue = parseFloat(document.getElementById('minTimeValue').value);
            const minTimeUnit = document.getElementById('minTimeUnit').value;
            const maxTimeValue = parseFloat(document.getElementById('maxTimeValue').value);
            const maxTimeUnit = document.getElementById('maxTimeUnit').value;
            
            const minMinutes = minTimeUnit === 'percent' ? Math.floor(config.duration * (minTimeValue / 100)) : minTimeValue;
            const maxMinutes = maxTimeUnit === 'percent' ? Math.floor(config.duration * (maxTimeValue / 100)) : maxTimeValue;
            
            const totalAvailableMinutes = config.playersOnField * config.duration;
            
            players.forEach(player => player.assignedMinutes = 0);
            
            let totalAssigned = 0;
            players.forEach(player => {
                player.assignedMinutes = Math.min(minMinutes, config.duration);
                totalAssigned += minMinutes;
            });
            
            let remainingMinutes = totalAvailableMinutes - totalAssigned;
            const priorityList = players.filter(p => priorityPlayers.includes(p.id));
            const nonPriorityList = players.filter(p => !priorityPlayers.includes(p.id));
            
            let index = 0;
            while (remainingMinutes > 0 && priorityList.length > 0) {
                const player = priorityList[index % priorityList.length];
                if (player.assignedMinutes < maxMinutes && player.assignedMinutes < config.duration) {
                    player.assignedMinutes++;
                    remainingMinutes--;
                }
                index++;
                if (player.assignedMinutes >= maxMinutes || player.assignedMinutes >= config.duration) {
                    const playerIndex = priorityList.indexOf(player);
                    if (playerIndex > -1) priorityList.splice(playerIndex, 1);
                }
            }
            
            index = 0;
            while (remainingMinutes > 0 && nonPriorityList.length > 0) {
                const player = nonPriorityList[index % nonPriorityList.length];
                if (player.assignedMinutes < maxMinutes && player.assignedMinutes < config.duration) {
                    player.assignedMinutes++;
                    remainingMinutes--;
                }
                index++;
                if (player.assignedMinutes >= maxMinutes || player.assignedMinutes >= config.duration) {
                    const playerIndex = nonPriorityList.indexOf(player);
                    if (playerIndex > -1) nonPriorityList.splice(playerIndex, 1);
                }
            }
            
            displayResults();
        }
        
        function displayResults() {
            const gameType = document.getElementById('gameType').value;
            const config = gameConfig[gameType];
            
            let resultsHTML = `
                <div class="stats">
                    <div class="stat-card"><div class="stat-value">${players.length}</div><div class="stat-label">Total Players</div></div>
                    <div class="stat-card"><div class="stat-value">${config.playersOnField}</div><div class="stat-label">On Field</div></div>
                    <div class="stat-card"><div class="stat-value">${config.duration}</div><div class="stat-label">Game Minutes</div></div>
                    <div class="stat-card"><div class="stat-value">${config.playersOnField * config.duration}</div><div class="stat-label">Total Minutes</div></div>
                </div>
                <div class="time-distribution">
            `;
            
            players.forEach(player => {
                const percentage = Math.round((player.assignedMinutes / config.duration) * 100);
                resultsHTML += `
                    <div class="time-item">
                        <div class="time-header">
                            <strong>#${player.jerseyNumber} ${player.name} ${player.isOnField ? 'üèÉ‚Äç‚ôÇÔ∏è' : 'ü™ë'}</strong>
                            <span>${player.assignedMinutes} min (${percentage}%)</span>
                        </div>
                        <div class="time-bar">
                            <div class="time-fill" style="width: ${percentage}%"></div>
                        </div>
                    </div>
                `;
            });
            
            resultsHTML += `</div>`;
            document.getElementById('results').innerHTML = resultsHTML;
        }
        
        function startSimulation() {
            const gameType = document.getElementById('gameType').value;
            const config = gameConfig[gameType];
            
            // Reset simulation state
            currentMinute = 0;
            isPaused = false;
            
            const simulationHTML = `
                <div class="simulation-container">
                    <div class="game-progress"><div class="progress-fill" id="gameProgress" style="width: 0%"></div></div>
                    <div class="simulation-log" id="simulationLog"></div>
                </div>
            `;
            
            document.getElementById('simulationContainer').innerHTML = simulationHTML;
            document.getElementById('simulationControls').style.display = 'flex';
            document.getElementById('substitutionPanel').style.display = 'none';
            
            const log = document.getElementById('simulationLog');
            const progress = document.getElementById('gameProgress');
            
            log.innerHTML = '<div class="log-entry">üöÄ Simulation started at 10x speed...</div>';
            
            // Clear any existing interval
            if (simulationInterval) clearInterval(simulationInterval);
            
            simulationInterval = setInterval(() => {
                if (isPaused) return;
                
                currentMinute++;
                const percentage = (currentMinute / config.duration) * 100;
                progress.style.width = percentage + '%';
                
                if (currentMinute === 1) {
                    log.innerHTML += `<div class="log-entry">‚è∞ Minute ${currentMinute}: Game started!</div>`;
                }
                
                // Substitution opportunities
                if (currentMinute === 25 || currentMinute === 50 || currentMinute === 70) {
                    log.innerHTML += `<div class="log-entry substitution">üîÑ Minute ${currentMinute}: Substitution opportunity - Click Pause to make changes</div>`;
                }
                
                if (currentMinute === 30) {
                    log.innerHTML += `<div class="log-entry suggestion">üí° Suggestion: Consider substituting ${players[0]?.name} to manage fatigue</div>`;
                }
                
                if (currentMinute === 60) {
                    const lowTimePlayers = players.filter(p => p.assignedMinutes < 30 && currentMinute > 60);
                    if (lowTimePlayers.length > 0) {
                        log.innerHTML += `<div class="log-entry suggestion">üí° Suggestion: ${lowTimePlayers[0]?.name} needs more playing time</div>`;
                    }
                }
                
                if (currentMinute % 10 === 0) {
                    log.innerHTML += `<div class="log-entry">‚è±Ô∏è Minute ${currentMinute}: Game in progress...</div>`;
                }
                
                log.scrollTop = log.scrollHeight;
                
                if (currentMinute >= config.duration) {
                    clearInterval(simulationInterval);
                    log.innerHTML += `<div class="log-entry">üéâ Final whistle! Game completed.</div>`;
                }
            }, 300);
            
            setTimeout(() => {
                log.innerHTML += `<div class="log-entry">üèüÔ∏è Formation: ${document.getElementById('formation').value} active</div>`;
            }, 1000);
        }
        
        function pauseSimulation() {
            isPaused = true;
            document.getElementById('substitutionPanel').style.display = 'block';
            updateSubstitutionPanel();
        }
        
        function resumeSimulation() {
            isPaused = false;
            document.getElementById('substitutionPanel').style.display = 'none';
        }
        
        function resetSimulation() {
            if (simulationInterval) clearInterval(simulationInterval);
            document.getElementById('simulationControls').style.display = 'none';
            document.getElementById('substitutionPanel').style.display = 'none';
            document.getElementById('simulationContainer').innerHTML = '<p style="text-align: center; color: #7f88d; padding: 1rem;">Start simulation to see substitution patterns and get AI suggestions</p>';
        }
        
        function updateSubstitutionPanel() {
            const fieldContainer = document.getElementById('fieldPlayers');
            const benchContainer = document.getElementById('benchPlayers');
            
            fieldContainer.innerHTML = '';
            benchContainer.innerHTML = '';
            
            fieldPlayers.forEach(player => {
                const playerDiv = document.createElement('div');
                playerDiv.className = 'player-circle';
                playerDiv.textContent = player.jerseyNumber;
                playerDiv.title = `${player.name} (#${player.jerseyNumber})`;
                playerDiv.onclick = () => substitutePlayer(player.id);
                fieldContainer.appendChild(playerDiv);
            });
            
            benchPlayers.forEach(player => {
                const playerDiv = document.createElement('div');
                playerDiv.className = 'player-circle bench';
                playerDiv.textContent = player.jerseyNumber;
                playerDiv.title = `${player.name} (#${player.jerseyNumber})`;
                playerDiv.onclick = () => substitutePlayer(player.id);
                benchContainer.appendChild(playerDiv);
            });
        }
        
        function substitutePlayer(playerId) {
            const player = players.find(p => p.id === playerId);
            if (player) {
                player.isOnField = !player.isOnField;
                updateFieldAndBench();
                updateSubstitutionPanel();
                drawFormation();
                displayPlayers();
            }
        }
        
        function applySubstitutions() {
            resumeSimulation();
            document.getElementById('simulationLog').innerHTML += `<div class="log-entry substitution">üîÑ Substitutions applied at minute ${currentMinute}</div>`;
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            initializeSampleTeam();
            updateFormations();
            updateTimeInputs();
            drawFormation();
        });
    </script>
</body>
</html>
